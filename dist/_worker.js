var pt=Object.defineProperty;var Te=t=>{throw TypeError(t)};var gt=(t,e,r)=>e in t?pt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var d=(t,e,r)=>gt(t,typeof e!="symbol"?e+"":e,r),De=(t,e,r)=>e.has(t)||Te("Cannot "+r);var i=(t,e,r)=>(De(t,e,"read from private field"),r?r.call(t):e.get(t)),g=(t,e,r)=>e.has(t)?Te("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,r),f=(t,e,r,s)=>(De(t,e,"write to private field"),s?s.call(t,r):e.set(t,r),r),w=(t,e,r)=>(De(t,e,"access private method"),r);var Fe=(t,e,r,s)=>({set _(n){f(t,e,n,r)},get _(){return i(t,e,s)}});var ke=(t,e,r)=>(s,n)=>{let o=-1;return a(0);async function a(l){if(l<=o)throw new Error("next() called multiple times");o=l;let h,c=!1,u;if(t[l]?(u=t[l][0][0],s.req.routeIndex=l):u=l===t.length&&n||void 0,u)try{h=await u(s,()=>a(l+1))}catch(p){if(p instanceof Error&&e)s.error=p,h=await e(p,s),c=!0;else throw p}else s.finalized===!1&&r&&(h=await r(s));return h&&(s.finalized===!1||c)&&(s.res=h),s}},wt=Symbol(),vt=async(t,e=Object.create(null))=>{const{all:r=!1,dot:s=!1}=e,o=(t instanceof tt?t.raw.headers:t.headers).get("Content-Type");return o!=null&&o.startsWith("multipart/form-data")||o!=null&&o.startsWith("application/x-www-form-urlencoded")?Rt(t,{all:r,dot:s}):{}};async function Rt(t,e){const r=await t.formData();return r?yt(r,e):{}}function yt(t,e){const r=Object.create(null);return t.forEach((s,n)=>{e.all||n.endsWith("[]")?Et(r,n,s):r[n]=s}),e.dot&&Object.entries(r).forEach(([s,n])=>{s.includes(".")&&(xt(r,s,n),delete r[s])}),r}var Et=(t,e,r)=>{t[e]!==void 0?Array.isArray(t[e])?t[e].push(r):t[e]=[t[e],r]:e.endsWith("[]")?t[e]=[r]:t[e]=r},xt=(t,e,r)=>{let s=t;const n=e.split(".");n.forEach((o,a)=>{a===n.length-1?s[o]=r:((!s[o]||typeof s[o]!="object"||Array.isArray(s[o])||s[o]instanceof File)&&(s[o]=Object.create(null)),s=s[o])})},Je=t=>{const e=t.split("/");return e[0]===""&&e.shift(),e},Ot=t=>{const{groups:e,path:r}=bt(t),s=Je(r);return mt(s,e)},bt=t=>{const e=[];return t=t.replace(/\{[^}]+\}/g,(r,s)=>{const n=`@${s}`;return e.push([n,r]),n}),{groups:e,path:t}},mt=(t,e)=>{for(let r=e.length-1;r>=0;r--){const[s]=e[r];for(let n=t.length-1;n>=0;n--)if(t[n].includes(s)){t[n]=t[n].replace(s,e[r][1]);break}}return t},me={},jt=(t,e)=>{if(t==="*")return"*";const r=t.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(r){const s=`${t}#${e}`;return me[s]||(r[2]?me[s]=e&&e[0]!==":"&&e[0]!=="*"?[s,r[1],new RegExp(`^${r[2]}(?=/${e})`)]:[t,r[1],new RegExp(`^${r[2]}$`)]:me[s]=[t,r[1],!0]),me[s]}return null},Ne=(t,e)=>{try{return e(t)}catch{return t.replace(/(?:%[0-9A-Fa-f]{2})+/g,r=>{try{return e(r)}catch{return r}})}},Pt=t=>Ne(t,decodeURI),Qe=t=>{const e=t.url,r=e.indexOf("/",e.indexOf(":")+4);let s=r;for(;s<e.length;s++){const n=e.charCodeAt(s);if(n===37){const o=e.indexOf("?",s),a=e.slice(r,o===-1?void 0:o);return Pt(a.includes("%25")?a.replace(/%25/g,"%2525"):a)}else if(n===63)break}return e.slice(r,s)},St=t=>{const e=Qe(t);return e.length>1&&e.at(-1)==="/"?e.slice(0,-1):e},re=(t,e,...r)=>(r.length&&(e=re(e,...r)),`${(t==null?void 0:t[0])==="/"?"":"/"}${t}${e==="/"?"":`${(t==null?void 0:t.at(-1))==="/"?"":"/"}${(e==null?void 0:e[0])==="/"?e.slice(1):e}`}`),Ye=t=>{if(t.charCodeAt(t.length-1)!==63||!t.includes(":"))return null;const e=t.split("/"),r=[];let s="";return e.forEach(n=>{if(n!==""&&!/\:/.test(n))s+="/"+n;else if(/\:/.test(n))if(/\?/.test(n)){r.length===0&&s===""?r.push("/"):r.push(s);const o=n.replace("?","");s+="/"+o,r.push(s)}else s+="/"+n}),r.filter((n,o,a)=>a.indexOf(n)===o)},_e=t=>/[%+]/.test(t)?(t.indexOf("+")!==-1&&(t=t.replace(/\+/g," ")),t.indexOf("%")!==-1?Ne(t,et):t):t,Ze=(t,e,r)=>{let s;if(!r&&e&&!/[%+]/.test(e)){let a=t.indexOf("?",8);if(a===-1)return;for(t.startsWith(e,a+1)||(a=t.indexOf(`&${e}`,a+1));a!==-1;){const l=t.charCodeAt(a+e.length+1);if(l===61){const h=a+e.length+2,c=t.indexOf("&",h);return _e(t.slice(h,c===-1?void 0:c))}else if(l==38||isNaN(l))return"";a=t.indexOf(`&${e}`,a+1)}if(s=/[%+]/.test(t),!s)return}const n={};s??(s=/[%+]/.test(t));let o=t.indexOf("?",8);for(;o!==-1;){const a=t.indexOf("&",o+1);let l=t.indexOf("=",o);l>a&&a!==-1&&(l=-1);let h=t.slice(o+1,l===-1?a===-1?void 0:a:l);if(s&&(h=_e(h)),o=a,h==="")continue;let c;l===-1?c="":(c=t.slice(l+1,a===-1?void 0:a),s&&(c=_e(c))),r?(n[h]&&Array.isArray(n[h])||(n[h]=[]),n[h].push(c)):n[h]??(n[h]=c)}return e?n[e]:n},At=Ze,Ht=(t,e)=>Ze(t,e,!0),et=decodeURIComponent,Ue=t=>Ne(t,et),ie,S,M,rt,st,Le,U,Be,tt=(Be=class{constructor(t,e="/",r=[[]]){g(this,M);d(this,"raw");g(this,ie);g(this,S);d(this,"routeIndex",0);d(this,"path");d(this,"bodyCache",{});g(this,U,t=>{const{bodyCache:e,raw:r}=this,s=e[t];if(s)return s;const n=Object.keys(e)[0];return n?e[n].then(o=>(n==="json"&&(o=JSON.stringify(o)),new Response(o)[t]())):e[t]=r[t]()});this.raw=t,this.path=e,f(this,S,r),f(this,ie,{})}param(t){return t?w(this,M,rt).call(this,t):w(this,M,st).call(this)}query(t){return At(this.url,t)}queries(t){return Ht(this.url,t)}header(t){if(t)return this.raw.headers.get(t)??void 0;const e={};return this.raw.headers.forEach((r,s)=>{e[s]=r}),e}async parseBody(t){var e;return(e=this.bodyCache).parsedBody??(e.parsedBody=await vt(this,t))}json(){return i(this,U).call(this,"text").then(t=>JSON.parse(t))}text(){return i(this,U).call(this,"text")}arrayBuffer(){return i(this,U).call(this,"arrayBuffer")}blob(){return i(this,U).call(this,"blob")}formData(){return i(this,U).call(this,"formData")}addValidatedData(t,e){i(this,ie)[t]=e}valid(t){return i(this,ie)[t]}get url(){return this.raw.url}get method(){return this.raw.method}get[wt](){return i(this,S)}get matchedRoutes(){return i(this,S)[0].map(([[,t]])=>t)}get routePath(){return i(this,S)[0].map(([[,t]])=>t)[this.routeIndex].path}},ie=new WeakMap,S=new WeakMap,M=new WeakSet,rt=function(t){const e=i(this,S)[0][this.routeIndex][1][t],r=w(this,M,Le).call(this,e);return r&&/\%/.test(r)?Ue(r):r},st=function(){const t={},e=Object.keys(i(this,S)[0][this.routeIndex][1]);for(const r of e){const s=w(this,M,Le).call(this,i(this,S)[0][this.routeIndex][1][r]);s!==void 0&&(t[r]=/\%/.test(s)?Ue(s):s)}return t},Le=function(t){return i(this,S)[1]?i(this,S)[1][t]:t},U=new WeakMap,Be),$t={Stringify:1},nt=async(t,e,r,s,n)=>{typeof t=="object"&&!(t instanceof String)&&(t instanceof Promise||(t=t.toString()),t instanceof Promise&&(t=await t));const o=t.callbacks;return o!=null&&o.length?(n?n[0]+=t:n=[t],Promise.all(o.map(l=>l({phase:e,buffer:n,context:s}))).then(l=>Promise.all(l.filter(Boolean).map(h=>nt(h,e,!1,s,n))).then(()=>n[0]))):Promise.resolve(t)},Ct="text/plain; charset=UTF-8",Ie=(t,e)=>({"Content-Type":t,...e}),we,ve,_,oe,I,j,Re,ae,ce,X,ye,Ee,W,se,qe,Dt=(qe=class{constructor(t,e){g(this,W);g(this,we);g(this,ve);d(this,"env",{});g(this,_);d(this,"finalized",!1);d(this,"error");g(this,oe);g(this,I);g(this,j);g(this,Re);g(this,ae);g(this,ce);g(this,X);g(this,ye);g(this,Ee);d(this,"render",(...t)=>(i(this,ae)??f(this,ae,e=>this.html(e)),i(this,ae).call(this,...t)));d(this,"setLayout",t=>f(this,Re,t));d(this,"getLayout",()=>i(this,Re));d(this,"setRenderer",t=>{f(this,ae,t)});d(this,"header",(t,e,r)=>{this.finalized&&f(this,j,new Response(i(this,j).body,i(this,j)));const s=i(this,j)?i(this,j).headers:i(this,X)??f(this,X,new Headers);e===void 0?s.delete(t):r!=null&&r.append?s.append(t,e):s.set(t,e)});d(this,"status",t=>{f(this,oe,t)});d(this,"set",(t,e)=>{i(this,_)??f(this,_,new Map),i(this,_).set(t,e)});d(this,"get",t=>i(this,_)?i(this,_).get(t):void 0);d(this,"newResponse",(...t)=>w(this,W,se).call(this,...t));d(this,"body",(t,e,r)=>w(this,W,se).call(this,t,e,r));d(this,"text",(t,e,r)=>!i(this,X)&&!i(this,oe)&&!e&&!r&&!this.finalized?new Response(t):w(this,W,se).call(this,t,e,Ie(Ct,r)));d(this,"json",(t,e,r)=>w(this,W,se).call(this,JSON.stringify(t),e,Ie("application/json",r)));d(this,"html",(t,e,r)=>{const s=n=>w(this,W,se).call(this,n,e,Ie("text/html; charset=UTF-8",r));return typeof t=="object"?nt(t,$t.Stringify,!1,{}).then(s):s(t)});d(this,"redirect",(t,e)=>{const r=String(t);return this.header("Location",/[^\x00-\xFF]/.test(r)?encodeURI(r):r),this.newResponse(null,e??302)});d(this,"notFound",()=>(i(this,ce)??f(this,ce,()=>new Response),i(this,ce).call(this,this)));f(this,we,t),e&&(f(this,I,e.executionCtx),this.env=e.env,f(this,ce,e.notFoundHandler),f(this,Ee,e.path),f(this,ye,e.matchResult))}get req(){return i(this,ve)??f(this,ve,new tt(i(this,we),i(this,Ee),i(this,ye))),i(this,ve)}get event(){if(i(this,I)&&"respondWith"in i(this,I))return i(this,I);throw Error("This context has no FetchEvent")}get executionCtx(){if(i(this,I))return i(this,I);throw Error("This context has no ExecutionContext")}get res(){return i(this,j)||f(this,j,new Response(null,{headers:i(this,X)??f(this,X,new Headers)}))}set res(t){if(i(this,j)&&t){t=new Response(t.body,t);for(const[e,r]of i(this,j).headers.entries())if(e!=="content-type")if(e==="set-cookie"){const s=i(this,j).headers.getSetCookie();t.headers.delete("set-cookie");for(const n of s)t.headers.append("set-cookie",n)}else t.headers.set(e,r)}f(this,j,t),this.finalized=!0}get var(){return i(this,_)?Object.fromEntries(i(this,_)):{}}},we=new WeakMap,ve=new WeakMap,_=new WeakMap,oe=new WeakMap,I=new WeakMap,j=new WeakMap,Re=new WeakMap,ae=new WeakMap,ce=new WeakMap,X=new WeakMap,ye=new WeakMap,Ee=new WeakMap,W=new WeakSet,se=function(t,e,r){const s=i(this,j)?new Headers(i(this,j).headers):i(this,X)??new Headers;if(typeof e=="object"&&"headers"in e){const o=e.headers instanceof Headers?e.headers:new Headers(e.headers);for(const[a,l]of o)a.toLowerCase()==="set-cookie"?s.append(a,l):s.set(a,l)}if(r)for(const[o,a]of Object.entries(r))if(typeof a=="string")s.set(o,a);else{s.delete(o);for(const l of a)s.append(o,l)}const n=typeof e=="number"?e:(e==null?void 0:e.status)??i(this,oe);return new Response(t,{status:n,headers:s})},qe),y="ALL",_t="all",It=["get","post","put","delete","options","patch"],it="Can not add a route since the matcher is already built.",ot=class extends Error{},Lt="__COMPOSED_HANDLER",Nt=t=>t.text("404 Not Found",404),We=(t,e)=>{if("getResponse"in t){const r=t.getResponse();return e.newResponse(r.body,r)}return console.error(t),e.text("Internal Server Error",500)},A,E,at,H,G,je,Pe,he,Mt=(he=class{constructor(e={}){g(this,E);d(this,"get");d(this,"post");d(this,"put");d(this,"delete");d(this,"options");d(this,"patch");d(this,"all");d(this,"on");d(this,"use");d(this,"router");d(this,"getPath");d(this,"_basePath","/");g(this,A,"/");d(this,"routes",[]);g(this,H,Nt);d(this,"errorHandler",We);d(this,"onError",e=>(this.errorHandler=e,this));d(this,"notFound",e=>(f(this,H,e),this));d(this,"fetch",(e,...r)=>w(this,E,Pe).call(this,e,r[1],r[0],e.method));d(this,"request",(e,r,s,n)=>e instanceof Request?this.fetch(r?new Request(e,r):e,s,n):(e=e.toString(),this.fetch(new Request(/^https?:\/\//.test(e)?e:`http://localhost${re("/",e)}`,r),s,n)));d(this,"fire",()=>{addEventListener("fetch",e=>{e.respondWith(w(this,E,Pe).call(this,e.request,e,void 0,e.request.method))})});[...It,_t].forEach(o=>{this[o]=(a,...l)=>(typeof a=="string"?f(this,A,a):w(this,E,G).call(this,o,i(this,A),a),l.forEach(h=>{w(this,E,G).call(this,o,i(this,A),h)}),this)}),this.on=(o,a,...l)=>{for(const h of[a].flat()){f(this,A,h);for(const c of[o].flat())l.map(u=>{w(this,E,G).call(this,c.toUpperCase(),i(this,A),u)})}return this},this.use=(o,...a)=>(typeof o=="string"?f(this,A,o):(f(this,A,"*"),a.unshift(o)),a.forEach(l=>{w(this,E,G).call(this,y,i(this,A),l)}),this);const{strict:s,...n}=e;Object.assign(this,n),this.getPath=s??!0?e.getPath??Qe:St}route(e,r){const s=this.basePath(e);return r.routes.map(n=>{var a;let o;r.errorHandler===We?o=n.handler:(o=async(l,h)=>(await ke([],r.errorHandler)(l,()=>n.handler(l,h))).res,o[Lt]=n.handler),w(a=s,E,G).call(a,n.method,n.path,o)}),this}basePath(e){const r=w(this,E,at).call(this);return r._basePath=re(this._basePath,e),r}mount(e,r,s){let n,o;s&&(typeof s=="function"?o=s:(o=s.optionHandler,s.replaceRequest===!1?n=h=>h:n=s.replaceRequest));const a=o?h=>{const c=o(h);return Array.isArray(c)?c:[c]}:h=>{let c;try{c=h.executionCtx}catch{}return[h.env,c]};n||(n=(()=>{const h=re(this._basePath,e),c=h==="/"?0:h.length;return u=>{const p=new URL(u.url);return p.pathname=p.pathname.slice(c)||"/",new Request(p,u)}})());const l=async(h,c)=>{const u=await r(n(h.req.raw),...a(h));if(u)return u;await c()};return w(this,E,G).call(this,y,re(e,"*"),l),this}},A=new WeakMap,E=new WeakSet,at=function(){const e=new he({router:this.router,getPath:this.getPath});return e.errorHandler=this.errorHandler,f(e,H,i(this,H)),e.routes=this.routes,e},H=new WeakMap,G=function(e,r,s){e=e.toUpperCase(),r=re(this._basePath,r);const n={basePath:this._basePath,path:r,method:e,handler:s};this.router.add(e,r,[s,n]),this.routes.push(n)},je=function(e,r){if(e instanceof Error)return this.errorHandler(e,r);throw e},Pe=function(e,r,s,n){if(n==="HEAD")return(async()=>new Response(null,await w(this,E,Pe).call(this,e,r,s,"GET")))();const o=this.getPath(e,{env:s}),a=this.router.match(n,o),l=new Dt(e,{path:o,matchResult:a,env:s,executionCtx:r,notFoundHandler:i(this,H)});if(a[0].length===1){let c;try{c=a[0][0][0][0](l,async()=>{l.res=await i(this,H).call(this,l)})}catch(u){return w(this,E,je).call(this,u,l)}return c instanceof Promise?c.then(u=>u||(l.finalized?l.res:i(this,H).call(this,l))).catch(u=>w(this,E,je).call(this,u,l)):c??i(this,H).call(this,l)}const h=ke(a[0],this.errorHandler,i(this,H));return(async()=>{try{const c=await h(l);if(!c.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return c.res}catch(c){return w(this,E,je).call(this,c,l)}})()},he),ct=[];function Tt(t,e){const r=this.buildAllMatchers(),s=(n,o)=>{const a=r[n]||r[y],l=a[2][o];if(l)return l;const h=o.match(a[0]);if(!h)return[[],ct];const c=h.indexOf("",1);return[a[1][c],h]};return this.match=s,s(t,e)}var Ae="[^/]+",pe=".*",ge="(?:|/.*)",ne=Symbol(),Ft=new Set(".\\+*[^]$()");function kt(t,e){return t.length===1?e.length===1?t<e?-1:1:-1:e.length===1||t===pe||t===ge?1:e===pe||e===ge?-1:t===Ae?1:e===Ae?-1:t.length===e.length?t<e?-1:1:e.length-t.length}var J,Q,$,ee,Ut=(ee=class{constructor(){g(this,J);g(this,Q);g(this,$,Object.create(null))}insert(e,r,s,n,o){if(e.length===0){if(i(this,J)!==void 0)throw ne;if(o)return;f(this,J,r);return}const[a,...l]=e,h=a==="*"?l.length===0?["","",pe]:["","",Ae]:a==="/*"?["","",ge]:a.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);let c;if(h){const u=h[1];let p=h[2]||Ae;if(u&&h[2]&&(p===".*"||(p=p.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(p))))throw ne;if(c=i(this,$)[p],!c){if(Object.keys(i(this,$)).some(v=>v!==pe&&v!==ge))throw ne;if(o)return;c=i(this,$)[p]=new ee,u!==""&&f(c,Q,n.varIndex++)}!o&&u!==""&&s.push([u,i(c,Q)])}else if(c=i(this,$)[a],!c){if(Object.keys(i(this,$)).some(u=>u.length>1&&u!==pe&&u!==ge))throw ne;if(o)return;c=i(this,$)[a]=new ee}c.insert(l,r,s,n,o)}buildRegExpStr(){const r=Object.keys(i(this,$)).sort(kt).map(s=>{const n=i(this,$)[s];return(typeof i(n,Q)=="number"?`(${s})@${i(n,Q)}`:Ft.has(s)?`\\${s}`:s)+n.buildRegExpStr()});return typeof i(this,J)=="number"&&r.unshift(`#${i(this,J)}`),r.length===0?"":r.length===1?r[0]:"(?:"+r.join("|")+")"}},J=new WeakMap,Q=new WeakMap,$=new WeakMap,ee),He,xe,ze,Wt=(ze=class{constructor(){g(this,He,{varIndex:0});g(this,xe,new Ut)}insert(t,e,r){const s=[],n=[];for(let a=0;;){let l=!1;if(t=t.replace(/\{[^}]+\}/g,h=>{const c=`@\\${a}`;return n[a]=[c,h],a++,l=!0,c}),!l)break}const o=t.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let a=n.length-1;a>=0;a--){const[l]=n[a];for(let h=o.length-1;h>=0;h--)if(o[h].indexOf(l)!==-1){o[h]=o[h].replace(l,n[a][1]);break}}return i(this,xe).insert(o,e,s,i(this,He),r),s}buildRegExp(){let t=i(this,xe).buildRegExpStr();if(t==="")return[/^$/,[],[]];let e=0;const r=[],s=[];return t=t.replace(/#(\d+)|@(\d+)|\.\*\$/g,(n,o,a)=>o!==void 0?(r[++e]=Number(o),"$()"):(a!==void 0&&(s[Number(a)]=++e),"")),[new RegExp(`^${t}`),r,s]}},He=new WeakMap,xe=new WeakMap,ze),Kt=[/^$/,[],Object.create(null)],Se=Object.create(null);function ht(t){return Se[t]??(Se[t]=new RegExp(t==="*"?"":`^${t.replace(/\/\*$|([.\\+*[^\]$()])/g,(e,r)=>r?`\\${r}`:"(?:|/.*)")}$`))}function Bt(){Se=Object.create(null)}function qt(t){var c;const e=new Wt,r=[];if(t.length===0)return Kt;const s=t.map(u=>[!/\*|\/:/.test(u[0]),...u]).sort(([u,p],[v,x])=>u?1:v?-1:p.length-x.length),n=Object.create(null);for(let u=0,p=-1,v=s.length;u<v;u++){const[x,P,T]=s[u];x?n[P]=[T.map(([m])=>[m,Object.create(null)]),ct]:p++;let R;try{R=e.insert(P,p,x)}catch(m){throw m===ne?new ot(P):m}x||(r[p]=T.map(([m,F])=>{const Oe=Object.create(null);for(F-=1;F>=0;F--){const[be,C]=R[F];Oe[be]=C}return[m,Oe]}))}const[o,a,l]=e.buildRegExp();for(let u=0,p=r.length;u<p;u++)for(let v=0,x=r[u].length;v<x;v++){const P=(c=r[u][v])==null?void 0:c[1];if(!P)continue;const T=Object.keys(P);for(let R=0,m=T.length;R<m;R++)P[T[R]]=l[P[T[R]]]}const h=[];for(const u in a)h[u]=r[a[u]];return[o,h,n]}function te(t,e){if(t){for(const r of Object.keys(t).sort((s,n)=>n.length-s.length))if(ht(r).test(e))return[...t[r]]}}var K,B,$e,lt,Ge,zt=(Ge=class{constructor(){g(this,$e);d(this,"name","RegExpRouter");g(this,K);g(this,B);d(this,"match",Tt);f(this,K,{[y]:Object.create(null)}),f(this,B,{[y]:Object.create(null)})}add(t,e,r){var l;const s=i(this,K),n=i(this,B);if(!s||!n)throw new Error(it);s[t]||[s,n].forEach(h=>{h[t]=Object.create(null),Object.keys(h[y]).forEach(c=>{h[t][c]=[...h[y][c]]})}),e==="/*"&&(e="*");const o=(e.match(/\/:/g)||[]).length;if(/\*$/.test(e)){const h=ht(e);t===y?Object.keys(s).forEach(c=>{var u;(u=s[c])[e]||(u[e]=te(s[c],e)||te(s[y],e)||[])}):(l=s[t])[e]||(l[e]=te(s[t],e)||te(s[y],e)||[]),Object.keys(s).forEach(c=>{(t===y||t===c)&&Object.keys(s[c]).forEach(u=>{h.test(u)&&s[c][u].push([r,o])})}),Object.keys(n).forEach(c=>{(t===y||t===c)&&Object.keys(n[c]).forEach(u=>h.test(u)&&n[c][u].push([r,o]))});return}const a=Ye(e)||[e];for(let h=0,c=a.length;h<c;h++){const u=a[h];Object.keys(n).forEach(p=>{var v;(t===y||t===p)&&((v=n[p])[u]||(v[u]=[...te(s[p],u)||te(s[y],u)||[]]),n[p][u].push([r,o-c+h+1]))})}}buildAllMatchers(){const t=Object.create(null);return Object.keys(i(this,B)).concat(Object.keys(i(this,K))).forEach(e=>{t[e]||(t[e]=w(this,$e,lt).call(this,e))}),f(this,K,f(this,B,void 0)),Bt(),t}},K=new WeakMap,B=new WeakMap,$e=new WeakSet,lt=function(t){const e=[];let r=t===y;return[i(this,K),i(this,B)].forEach(s=>{const n=s[t]?Object.keys(s[t]).map(o=>[o,s[t][o]]):[];n.length!==0?(r||(r=!0),e.push(...n)):t!==y&&e.push(...Object.keys(s[y]).map(o=>[o,s[y][o]]))}),r?qt(e):null},Ge),q,L,Ve,Gt=(Ve=class{constructor(t){d(this,"name","SmartRouter");g(this,q,[]);g(this,L,[]);f(this,q,t.routers)}add(t,e,r){if(!i(this,L))throw new Error(it);i(this,L).push([t,e,r])}match(t,e){if(!i(this,L))throw new Error("Fatal error");const r=i(this,q),s=i(this,L),n=r.length;let o=0,a;for(;o<n;o++){const l=r[o];try{for(let h=0,c=s.length;h<c;h++)l.add(...s[h]);a=l.match(t,e)}catch(h){if(h instanceof ot)continue;throw h}this.match=l.match.bind(l),f(this,q,[l]),f(this,L,void 0);break}if(o===n)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,a}get activeRouter(){if(i(this,L)||i(this,q).length!==1)throw new Error("No active router has been determined yet.");return i(this,q)[0]}},q=new WeakMap,L=new WeakMap,Ve),de=Object.create(null),z,b,Y,le,O,N,V,ue,Vt=(ue=class{constructor(e,r,s){g(this,N);g(this,z);g(this,b);g(this,Y);g(this,le,0);g(this,O,de);if(f(this,b,s||Object.create(null)),f(this,z,[]),e&&r){const n=Object.create(null);n[e]={handler:r,possibleKeys:[],score:0},f(this,z,[n])}f(this,Y,[])}insert(e,r,s){f(this,le,++Fe(this,le)._);let n=this;const o=Ot(r),a=[];for(let l=0,h=o.length;l<h;l++){const c=o[l],u=o[l+1],p=jt(c,u),v=Array.isArray(p)?p[0]:c;if(v in i(n,b)){n=i(n,b)[v],p&&a.push(p[1]);continue}i(n,b)[v]=new ue,p&&(i(n,Y).push(p),a.push(p[1])),n=i(n,b)[v]}return i(n,z).push({[e]:{handler:s,possibleKeys:a.filter((l,h,c)=>c.indexOf(l)===h),score:i(this,le)}}),n}search(e,r){var h;const s=[];f(this,O,de);let o=[this];const a=Je(r),l=[];for(let c=0,u=a.length;c<u;c++){const p=a[c],v=c===u-1,x=[];for(let P=0,T=o.length;P<T;P++){const R=o[P],m=i(R,b)[p];m&&(f(m,O,i(R,O)),v?(i(m,b)["*"]&&s.push(...w(this,N,V).call(this,i(m,b)["*"],e,i(R,O))),s.push(...w(this,N,V).call(this,m,e,i(R,O)))):x.push(m));for(let F=0,Oe=i(R,Y).length;F<Oe;F++){const be=i(R,Y)[F],C=i(R,O)===de?{}:{...i(R,O)};if(be==="*"){const k=i(R,b)["*"];k&&(s.push(...w(this,N,V).call(this,k,e,i(R,O))),f(k,O,C),x.push(k));continue}const[ft,Me,fe]=be;if(!p&&!(fe instanceof RegExp))continue;const D=i(R,b)[ft],dt=a.slice(c).join("/");if(fe instanceof RegExp){const k=fe.exec(dt);if(k){if(C[Me]=k[0],s.push(...w(this,N,V).call(this,D,e,i(R,O),C)),Object.keys(i(D,b)).length){f(D,O,C);const Ce=((h=k[0].match(/\//))==null?void 0:h.length)??0;(l[Ce]||(l[Ce]=[])).push(D)}continue}}(fe===!0||fe.test(p))&&(C[Me]=p,v?(s.push(...w(this,N,V).call(this,D,e,C,i(R,O))),i(D,b)["*"]&&s.push(...w(this,N,V).call(this,i(D,b)["*"],e,C,i(R,O)))):(f(D,O,C),x.push(D)))}}o=x.concat(l.shift()??[])}return s.length>1&&s.sort((c,u)=>c.score-u.score),[s.map(({handler:c,params:u})=>[c,u])]}},z=new WeakMap,b=new WeakMap,Y=new WeakMap,le=new WeakMap,O=new WeakMap,N=new WeakSet,V=function(e,r,s,n){const o=[];for(let a=0,l=i(e,z).length;a<l;a++){const h=i(e,z)[a],c=h[r]||h[y],u={};if(c!==void 0&&(c.params=Object.create(null),o.push(c),s!==de||n&&n!==de))for(let p=0,v=c.possibleKeys.length;p<v;p++){const x=c.possibleKeys[p],P=u[c.score];c.params[x]=n!=null&&n[x]&&!P?n[x]:s[x]??(n==null?void 0:n[x]),u[c.score]=!0}}return o},ue),Z,Xe,Xt=(Xe=class{constructor(){d(this,"name","TrieRouter");g(this,Z);f(this,Z,new Vt)}add(t,e,r){const s=Ye(e);if(s){for(let n=0,o=s.length;n<o;n++)i(this,Z).insert(t,s[n],r);return}i(this,Z).insert(t,e,r)}match(t,e){return i(this,Z).search(t,e)}},Z=new WeakMap,Xe),Jt=class extends Mt{constructor(t={}){super(t),this.router=t.router??new Gt({routers:[new zt,new Xt]})}};const Ke=new Jt,Qt=Object.assign({});let ut=!1;for(const[,t]of Object.entries(Qt))t&&(Ke.route("/",t),Ke.notFound(t.notFoundHandler),ut=!0);if(!ut)throw new Error("Can't import modules from ['/src/index.tsx','/app/server.ts']");export{Ke as default};
